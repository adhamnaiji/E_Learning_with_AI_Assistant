<div class="course-detail-page" *ngIf="course && !isLoading">
  <div class="course-hero">
    <div class="container">
      <div class="course-header">
        <div class="course-info-section">
          <div class="breadcrumb">
            <a routerLink="/courses">Courses</a> / <span>{{course.category}}</span>
          </div>
          <h1>{{course.title}}</h1>
          <p class="course-subtitle">{{course.description}}</p>
          <div class="course-stats">
            <span class="rating">⭐ {{course.rating}} Rating</span>
            
          </div>
          <div class="instructor-info">
            <span>Created by <strong>{{course.instructor}}</strong></span>
          </div>
        </div>
        <div class="course-card-preview">
<img [src]="course.thumbnail" [alt]="course.title" class="course-thumbnail">
          <div class="card-content">
            <div class="price-section">
              <span class="price">${{course.price}}</span>
              <span *ngIf="course.originalPrice" class="original-price">${{course.originalPrice}}</span>
            </div>
            <button 
              *ngIf="!isEnrolled" 
              (click)="enrollCourse()" 
              class="btn btn-primary btn-block">
              Enroll Now
            </button>
            <button 
              *ngIf="isEnrolled" 
              class="btn btn-success btn-block" 
              disabled>
              ✓ Enrolled
            </button>
            <div class="includes">
              <h4>This course includes:</h4>
              <ul>
                <li>📺 {{course.lessons.length}} Video Lessons</li>
                <li>📄 Downloadable Resources</li>
                <li>📱 Mobile Access</li>
                <li>🏆 Certificate of Completion</li>
                <li>♾️ Lifetime Access</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<!-- Add AI Chat Widget -->
<app-ai-chat [courseId]="course.id"></app-ai-chat>

  <div class="course-content">
    <div class="container">
      <div class="content-grid">
        <div class="main-content">
          <!-- Video Player Section -->
          <section class="section video-section" *ngIf="isEnrolled">
            <h2>{{course.lessons[selectedLesson].title}}</h2>
            <div class="video-container">
              <iframe
                *ngIf="currentVideoUrl"
                [src]="currentVideoUrl"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
              </iframe>
            </div>
            <div class="video-info">
              <p>{{course.lessons[selectedLesson].description}}</p>
              <div class="video-meta">
                <span>⏱ Duration: {{course.lessons[selectedLesson].duration}}</span>
                <span>📚 Lesson {{selectedLesson + 1}} of {{course.lessons.length}}</span>
              </div>
            </div>
          </section>

          <!-- Preview Message for Non-Enrolled Users -->
          <section class="section preview-section" *ngIf="!isEnrolled">
            <div class="preview-message">
              <h2>🔒 Course Content Locked</h2>
              <p>Enroll in this course to access all video lessons and resources</p>
              <button (click)="enrollCourse()" class="btn btn-primary">
                Enroll Now for ${{course.price}}
              </button>
            </div>
          </section>

         

          <!-- Course Content / Lessons -->
          <section class="section">
            <h2>Course Content</h2>
            <div class="course-curriculum-header">
              <span>{{course.lessons.length}} lessons</span>
            </div>
            <div class="lessons-list">
              <div 
                *ngFor="let lesson of course.lessons; let i = index" 
                class="lesson-item"
                [class.active]="i === selectedLesson"
                [class.locked]="!isEnrolled"
                (click)="isEnrolled && selectLesson(i)">
                <div class="lesson-info">
                  <span class="lesson-number">{{i + 1}}</span>
                  <div class="lesson-details">
                    <h4>
                      <span *ngIf="!isEnrolled" class="lock-icon">🔒</span>
                      {{lesson.title}}
                    </h4>
                    <p>{{lesson.description}}</p>
                  </div>
                </div>
                <div class="lesson-meta">
                  <span class="lesson-duration">{{lesson.duration}}</span>
                  <span *ngIf="i === selectedLesson && isEnrolled" class="playing">▶ Playing</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Requirements -->
          <section class="section">
            <h2>Requirements</h2>
            <ul class="requirements-list">
              <li *ngFor="let req of course.requirements">{{req}}</li>
            </ul>
          </section>

          
        </div>

        <div class="sidebar">
          

          <!-- Instructor -->
          <div class="sidebar-section">
            <h3>Instructor</h3>
            <div class="instructor-card">
              <div class="instructor-avatar">{{course.instructor.charAt(0)}}</div>
              <div class="instructor-details">
                <h4>{{course.instructor}}</h4>
                <p>Expert Instructor</p>
              </div>
            </div>
          </div>

          
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="loading">
  <p>Loading course details...</p>
</div>

<div *ngIf="!course && !isLoading" class="not-found">
  <h2>Course Not Found</h2>
  <a routerLink="/courses" class="btn btn-primary">Back to Courses</a>
</div>
