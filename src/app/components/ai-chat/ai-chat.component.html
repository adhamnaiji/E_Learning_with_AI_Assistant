<div class="chat-widget" [class.open]="isOpen">
  <!-- Chat Toggle Button -->
  <button class="chat-toggle" (click)="toggleChat()" [attr.aria-label]="isOpen ? 'Close chat' : 'Open chat'">
    <span *ngIf="!isOpen" class="icon">💬</span>
    <span *ngIf="isOpen" class="icon">✕</span>
  </button>

  <!-- Chat Window -->
  <div class="chat-window" *ngIf="isOpen">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="header-content">
        <span class="bot-icon">🤖</span>
        <div class="header-text">
          <h3>AI Learning Assistant</h3>
          <p class="status">Online</p>
        </div>
      </div>
      <button (click)="clearChat()" class="clear-btn" title="Clear conversation">
        <span>🗑️</span>
      </button>
    </div>

    <!-- Chat Messages Area -->
    <div class="chat-messages">
      <!-- Welcome Message (shown when no messages) -->
      <div class="welcome-message" *ngIf="messages.length === 0">
        <p class="welcome-emoji">👋</p>
        <h4>Hi! I'm your AI assistant</h4>
        <p>Ask me anything about this course, and I'll help you learn!</p>
      </div>

      <!-- Message List -->
      <div *ngFor="let message of messages" 
           class="message"
           [class.user]="message.role === 'user'"
           [class.assistant]="message.role === 'assistant'">
        <div class="message-avatar">
          <span *ngIf="message.role === 'user'">👤</span>
          <span *ngIf="message.role === 'assistant'">🤖</span>
        </div>
        <div class="message-wrapper">
          <div class="message-content">
            {{message.content}}
          </div>
          <div class="message-time">
            {{message.timestamp | date:'short'}}
          </div>
          <!-- Sources Section (if available) -->
          <div class="message-sources" *ngIf="message.sources && message.sources.length > 0">
            <p class="sources-title">📚 Sources:</p>
            <div class="source-item" *ngFor="let source of message.sources">
              <span class="source-title">{{source.title}}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="message assistant">
        <div class="message-avatar">
          <span>🤖</span>
        </div>
        <div class="message-wrapper">
          <div class="message-content typing">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input Area -->
    <div class="chat-input">
      <textarea 
        [(ngModel)]="currentMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Ask me anything about the course..."
        [disabled]="isLoading"
        rows="1"
      ></textarea>
      <button 
        (click)="sendMessage()" 
        [disabled]="isLoading || !currentMessage.trim()"
        class="send-btn"
        title="Send message">
        <span *ngIf="!isLoading">➤</span>
        <span *ngIf="isLoading" class="loading-spinner">⟳</span>
      </button>
    </div>
  </div>
</div>
